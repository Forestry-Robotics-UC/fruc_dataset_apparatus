version: "3"

networks:
  ros:
    driver: bridge

services:
  ros-master:
    image: ros:noetic-ros-core
    networks:
      - ros
    environment:
      - "ROS_IP=172.19.0.2"
    command: stdbuf -o L roscore

  ros-melodic:
    image: "mjpc13/ros:melodic-mynteye"
    depends_on:
      - ros-master
    #Mount the src/ folder inside the docker container
    volumes:
        - type: bind
          source: ../catkin_ws/src
          target: /opt/app/catkin_ws/src
    networks:
      - ros
    privileged: true
    environment:
        - "ROS_MASTER_URI=http://ros-master:11311"
        - SETUP=/opt/app/catkin_ws/devel/setup.bash
        - BUILDLIST= sensor-tools xsens_driver
        - ROSPACKAGE=sensor-tools
        - LAUNCHFILE=apparatus-melodic.launch
        - XSENS_MODE=sotac #Paramenters related to configuration of Xsens MTi Legacy
        - XSENS_SETTINGS=tqMAG #Paramenters related to configuration of Xsens MTi Legacy
    command: ./launch.sh
  
  ros-noetic:
    image: "mjpc13/ros:noetic-semfire-apparatus"
    depends_on:
      - ros-master
    #Mount the src/ folder inside the docker container
    volumes:
        - type: bind
          source: ../catkin_ws/src
          target: /opt/app/catkin_ws/src
    networks:
      - ros
    privileged: true
    environment:
        - "ROS_MASTER_URI=http://ros-master:11311"
        - SETUP=/opt/app/catkin_ws/devel/setup.bash
        - BUILDLIST= sensor-tools livox_ros_driver realsense2_camera #Only this packages will be build 
        - ROSPACKAGE=sensor-tools #rospackage of the desired launchfile
        - LAUNCHFILE=apparatus-noetic.launch #launchfile to be launch after compilation
    command: ./launch.sh